<div>
    <h1 class="page_title">Blog</h1>
    <hr>
    <div id="blog_container">
        <script id="blog_template" type="x-tmpl-mustache/text">
            <div class="blogpost">
                <h2><a href='/posts/{{slug}}'>{{title}}</a></h2>
                <p>{{publish_date}} + {{author}}</p>
                <img src="{{image_url}}" />
                <p class="blogpost_content">{{{body}}}</p>
                <a href='/posts/{{slug}}' class="readmore">Read More</a>
            </div>
        </script>
    </div>
</div>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            var blog = getBlogDataBySlug('cornwall-main');
            console.log(blog);
            var posts = blog.posts.sortBy(function(o){ return moment(o.publish_date) }).reverse();
            
            renderPosts('#blog_container', '#blog_template', posts);
            // $.each(blogs, function(key, val){
                
            // });
            
        }
        function renderPosts(container, template, collection){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(template).html();
            // var counter = 1;
            Mustache.parse(template_html);   // optional, speeds up future uses
            $.each( collection , function( key, val ) {
                if (val.image_url.indexOf('missing.png') > -1) {
                    val.image_url = "//codecloud.cdn.speedyrails.net/sites/56056be06e6f641a1d020000/image/png/1446826281000/stc-logo-holiday-360 copy.png";
                } else {
                    val.post_image = val.image_url;
                }
                if(val.html_body.length > 500){
                    val.html_body = val.html_body.substring(0,499) + "...";
                }
                else{
                    val.description_short = val.body;
                }
                // val.description_short = val.description_short.replace("&amp;", "&");
                
                var published_on = moment(val.publish_date).tz(getPropertyTimeZone());
                val.publish_date = published_on.format("MMMM Do, YYYY");
                
                var rendered = Mustache.render(template_html,val);
                item_rendered.push(rendered);
            });
            $(container).html(item_rendered.join(''));
        }
        loadMallDataCached(renderAll); 
    })
</script>