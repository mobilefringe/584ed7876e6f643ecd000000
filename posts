<div>
    <h1 class="page_title">Blog</h1>
    <hr>
    <div id="blog_container">
        <script id="blog_template" type="x-tmpl-mustache/text">
            <div class="blogpost">
                <h2><a href='/posts/{{slug}}'>{{title}}</a></h2>
                <p>{{publish_date}} + {{author}}</p>
                <a href='/posts/{{slug}}'><img src="{{image_url}}"/></a>
                <p class="blogpost_content">{{body}}</p>
                <a href='/posts/{{slug}}' class="readmore">Read More</a>
            </div>
            <div class="line_break ">&nbsp;</div>
        </script>
    </div>
</div>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            var blog = getBlogDataBySlug('cornwall-main');
            console.log(blog);
            var posts = blog.posts.sortBy(function(o){ return moment(o.publish_date) }).reverse();
            
            renderPosts('#blog_container', '#blog_template', posts);
        }
        function renderPosts(container, template, collection){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(template).html();
            Mustache.parse(template_html);   // optional, speeds up future uses
            $.each( collection , function( key, val ) {
                if (val.image_url.indexOf('missing.png') > -1) {
                    val.image_url = "//www.mallmaverick.com/system/sites/logo_images/000/000/023/original/mall_logo.png?1381508700";
                } else {
                    val.image_url = val.image_url;
                }

                var published_on = moment(val.publish_date).tz(getPropertyTimeZone());
                val.publish_date = published_on.format("MMMM Do, YYYY");
                
                var rendered = Mustache.render(template_html,val);
                item_rendered.push(rendered);
            });
            $(container).html(item_rendered.join(''));
        }
        loadMallDataCached(renderAll); 
    })
</script>