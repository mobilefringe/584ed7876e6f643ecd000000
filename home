<div class="mfp-content">
    <div class="homepop_up_container">
        <div class="pop_up_form_container">
            <div class="pop_up_form">
                <h4 class="popup_header1">JOIN OUR NEWSLETTER</h4>
                <form method="post" action ="http://mobilefringe.createsend.com/t/d/s/ykouu/"  onsubmit="return validate_pop_up()">
                    <label for="name_pop_up">Name</label>
                    <input id="name_pop_up" type="text" name=cm-name>
                    
                    <label for="email_pop_up">Email</label>
                    <input id="email_pop_up" type="text" name=cm-ykouu-ykouu>
                    
                    <label for="postal_pop_up" >Postal Code</label>
                    <input id="postal_pop_up" type="text" name=cm-f-ydltut>
                    
                    <label>
                        <input id="subscribe_newsletter_popup" type="checkbox">Subscribe to receive newsletters from Cornwall Centre
                    </label>
                    <br /> 
                    <input class="btn btn-success" value = "Submit" type="submit">
                </form>
            </div>
        </div>
    </div>
</div>


<div class="flexslider trim_screen">
    <ul class="slides" id="home_banner">            
        <script id="home_banner_template" type="x-tmpl-mustache/text">
            <li>
                {{#url}}
                <a class="banner_image_li" href="{{url}}" >
                {{/url}}
                    <img src="{{image_url}}" alt="Banner Image"/>
                </a>
            </li>
        </script>                
    </ul>        
</div>

<script>
$(document).ready(function(){
    function renderAll(){
        init();
        var banners = getBanners();
        renderBanner('#home_banner_template','#home_banner', banners);

        $('.flexslider').flexslider({
            animation: "slide",
        });
        
        // *** POP UP *** //
        $("#success_subscribe_popup").hide();
            
        $(".popup_close").click(function(){
            $(".popup_bg").fadeOut();
        });
        
        var popup = getPopups()[0];
        var popup_url = getImageURL(popup.photo_url);
        console.log(popup_url);
        $(".mfp-content").css("background-image": popup_url);
        var toc_show_popup = $.cookie("toc_show_popup");
        if (toc_show_popup == null) {
            
            $(".popup_newsletter .subscribe p").show();
            $(".popup_bg").show();            
        }
        $("#hide_popup").click(function(){
            if ($(this).is(":checked")){
                $(".popup_bg").fadeOut();    
                $.cookie('toc_show_popup', 'yes'); 
                $.cookie('toc_show_popup', 'yes', { expires: 1, path: '/' });        
            }
        });
        
        $(".popup_bg").click(function(event){            
            if( !$( event.target).is('.popup_newsletter') ) {
                $(".popup_bg").fadeOut();
            } else {
                event.stopPropagation();
            }
        });
            
        $(".popup_bg .popup_newsletter").click(function(event){            
            event.stopPropagation();
        });
    
        $("#popup_btn").click(function(){    
            subscribe_email_popup();
        });
        
        function validate_pop_up(){
            if($('#subscribe_newsletter_popup').is(":checked"))
            return true;
            else{
                alert("Please check the 'Subscribe to recieve newsletter' checkbox")
                return false;
            }
        }
    
        function subscribe_email_popup(){ 
            if (isValidEmailAddress($("#subscribe_email_popup").val())){   
                var action="http://mobilefringe.createsend.com/t/d/s/ykblt/"
                var data = {}
                data["cm-ykblt-ykblt"] = $("#subscribe_email_popup").val();
                data["cm-name"] = $("#subscribe_first_name").val() + " " + $("#subscribe_last_name").val();
                $.getJSON(
                    action + "?callback=?",
                    data,
                    function (data) {
                        if (data.Status === 400) {
                            alert("Veuillez essayer de nouveau s’il vous plaît.");
                        } else { // 200
                            $("#success_subscribe_popup").fadeIn();
                        }
                });    
            } else {
                alert("Veuillez entrez un courriel valide.")
            }
        }
    }

    loadMallData(renderAll);
});
</script>