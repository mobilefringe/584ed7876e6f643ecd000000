<div class="mfp-with-anim homepop_up_container">
    <div class="pop_up_form_container">
        <div class="pop_up_form">
            <h4 class="popup_header1">JOIN OUR NEWSLETTER</h4>
            <form method="post" action ="http://mobilefringe.createsend.com/t/d/s/ykouu/"  onsubmit="return validate_pop_up()">
                <label for="name_pop_up">Name</label>
                <input id="name_pop_up" type="text" name=cm-name>
                
                <label for="email_pop_up">Email</label>
                <input id="email_pop_up" type="text" name=cm-ykouu-ykouu>
                
                <label for="postal_pop_up" >Postal Code</label>
                <input id="postal_pop_up" type="text" name=cm-f-ydltut>
                
                <label>
                    <input id="subscribe_newsletter_popup" type="checkbox">Subscribe to receive newsletters from Cornwall Centre
                </label>
                <br /> 
                <input class="btn btn-success" value = "Submit" type="submit">
            </form>
        </div>
    </div>
</div>


<div class="flexslider trim_screen">
    <ul class="slides" id="home_banner">            
        <script id="home_banner_template" type="x-tmpl-mustache/text">
            <li>
                {{#url}}
                <a class="banner_image_li" href="{{url}}" >
                {{/url}}
                    <img src="{{image_url}}" alt="Banner Image"/>
                </a>
            </li>
        </script>                
    </ul>        
</div>

<script>
$(document).ready(function(){
    function renderAll(){
        init();
        var banners = getBanners();
        renderBanner('#home_banner_template','#home_banner', banners);

        $('.flexslider').flexslider({
            animation: "slide",
        });
        
        var visited = $.cookie("visited")
        if (visited == null) {
            $.magnificPopup.open({
              items: {
                src: '<div class="mfp-with-anim homepop_up_container" style="height:100%;background:url(/system/popups/photos/000/000/059/original/CC-60A-white-550x474.jpg?1416921997)"><div class="pop_up_form_container"><div class="pop_up_form"><h4 class="popup_header1">JOIN OUR NEWSLETTER</h4><form method="post" action ="http://mobilefringe.createsend.com/t/d/s/ykouu/"  onsubmit="return validate_pop_up()"><label for="name_pop_up">Name</label><input id="name_pop_up" type="text" name=cm-name><label for="email_pop_up">Email</label><input id="email_pop_up" type="text" name=cm-ykouu-ykouu><label for="postal_pop_up" >Postal Code</label><input id="postal_pop_up" type="text" name=cm-f-ydltut><label><input id="subscribe_newsletter_popup" type="checkbox">Subscribe to receive newsletters from Cornwall Centre</label><br /> <input class="btn btn-success" value = "Submit" type="submit"></form></div></div></div>', 
                type: 'inline'
              }
            });
            $.cookie('visited', 'yes'); 
        }
        var date = new Date();
        var minutes = 1439;
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        $.cookie('visited', 'yes', { expires: date, path: '/' });
        
        $("#success_subscribe_popup").hide();
        
        
        var toc_show_popup = $.cookie("toc_show_popup");
        if (toc_show_popup == null) {
            $(".popup_newsletter .subscribe p").show();
            $(".popup_bg").show();            
        }
        $("#hide_popup").change(function(){
            if ($(this).is(":checked")){
                $(".popup_bg").fadeOut();    
                $.cookie('toc_show_popup', 'yes'); 
                $.cookie('toc_show_popup', 'yes', { expires: 1, path: '/' });        
            }
        })
        
        
         $(".popup_bg").click(function(event){            
            if( !$( event.target).is('.popup_newsletter') ) {
               close_popup();
            } else {
                event.stopPropagation();
            }
        })
        $(".popup_bg .popup_newsletter").click(function(event){            
            event.stopPropagation();
        })
        var newsletter_img = $("#social_270 img").attr("src");
        $("#social_270 img").hover(
            function(){
                $(this).attr("src", "https://www.mallmaverick.com/system/site_images/photos/000/001/679/original/socialicon_newletter_clicked_2.png?1393873885")
            },
            function(){             
                $(this).attr("src", newsletter_img)                
            }
        );
        
        $( "#subscribe_letter_btn_img" ).hover(
          function() {
            $( this ).attr( "src", "https://www.mallmaverick.com/system/site_images/photos/000/001/877/original/submit_clicked.png?1393866516" );
          }, function() {
            $( this ).attr("src", "https://www.mallmaverick.com/system/site_images/photos/000/001/876/original/submit.png?1393866496" );
          }
        );
    })
    
    function validate_pop_up(){
        if($('#subscribe_newsletter_popup').is(":checked"))
        return true;
        else{
            alert("Please check the 'Subscribe to recieve newsletter' checkbox")
            return false;
        }
    }
    
    function close_popup(){
        $(".popup_bg").fadeOut();
    }
    
        
    }
    loadMallData(renderAll);
    
    function subscribe_email_popup(){ 
        if (isValidEmailAddress($("#subscribe_email_popup").val())){   
            var action="http://mobilefringe.createsend.com/t/d/s/ykblt/"
            var data = {}
            data["cm-ykblt-ykblt"] = $("#subscribe_email_popup").val();
            data["cm-name"] = $("#subscribe_first_name").val() + " " + $("#subscribe_last_name").val();
            $.getJSON(
                action + "?callback=?",
                data,
                function (data) {
                    if (data.Status === 400) {
                        alert("Veuillez essayer de nouveau s’il vous plaît.");
                    } else { // 200
                        $("#success_subscribe_popup").fadeIn();
                    }
            });    
        } else {
            alert("Veuillez entrez un courriel valide.")
        }
    }
});
</script>