<div class="popup_home hidden_now">
    <img src="#" alt="pop up" />
    <div class="homepop_up_container">
        <div class="pop_up_form_container">
            <div class="pop_up_form">
                <h4 class="popup_header1">JOIN OUR NEWSLETTER</h4>
                <form action=//mobilefringe.createsend.com/t/d/s/ykouu/ method="post" id="subForm">
                    <label for="name_pop_up">Name</label>
                    <input id="name_pop_up" type="text" name=cm-name>
                    
                    <label for="fieldEmail">Email*</label>
                    <input id="fieldEmail" name=cm-ykouu-ykouu type="email" required placeholder="Your Email" />
                    
                    <label for="postal_pop_up" >Postal Code</label>
                    <input id="postal_pop_up" type="text" name=cm-f-ydltut>
                    
                    <label>
                        <label style="display:none" for="agree_terms">Subscribe</label>
                        <input type="checkbox" class="info_check" id="agree_terms" /> I agree to receive newsletters from Cornwall Centre
                    </label>
                    <br /> 
                    <button class="btn btn-success"/>Subscribe</button>
                    <br/>
                    <span id="success_subscribe">Thank you for subscribing to our newsletter.</span>
                </form>
            </div>
        </div>
    </div>
    <i class="fa fa-remove close_popup"></i>
</div>

<div class="flexslider trim_screen">
    <ul class="slides" id="home_banner">            
        <script id="home_banner_template" type="x-tmpl-mustache/text">
            <li>
                {{#url}}
                <a class="banner_image_li" href="{{url}}" >
                {{/url}}
                    <img src="{{image_url}}" alt="Banner Image"/>
                </a>
            </li>
        </script>                
    </ul>        
</div>

<script>
$(document).ready(function(){
    function renderAll(){
        init();
        var banners = getBanners();
        renderBanner('#home_banner_template','#home_banner', banners);

        $('.flexslider').flexslider({
            animation: "slide",
        });
        
        // *** POP UP *** //
        var window_width = $( window ).width();
        if (window_width > 769) {
            // if($.cookie("popup_viewed") != "true"){
            //     $.cookie("popup_viewed", "true", { expires: 1 });
                var popup = getPopups()[0];
                if (popup != undefined){
                    $('.popup_home a').attr('href', popup.photo_link)
                    $('.popup_home img').attr('src', '//mallmaverick.cdn.speedyrails.net' + popup.photo_url)
                    $('<div class="modal-backdrop custom_backdrop"></div>').appendTo(document.body);
                    $('.popup_home').show()
                }
            // }
        }
        
        $('.close_popup, .custom_backdrop').click(function(){
            $(".modal-backdrop").remove();
	        $(".popup_home").remove();
        })
            
        $(".popup_close").click(function(){
            $(".popup_bg").fadeOut();
        });
        
        // $('#popup_form').submit(function(e){
        //     e.preventDefault();
        //     // $('.btn-success').prop('disabled', true);
        //     subscribe_email_popup();
        // });
            
        //PopUp Form Sign Up
        $('#popup_form').submit(function (e) {
            if ($("#subscribe_newsletter_popup").prop("checked") != true){
                alert("Please agree to the term and conditions.");
                return false;
            }
            e.preventDefault();
            $.getJSON(
                this.action + "?callback=?",
                $(this).serialize(),
                function (data) {
                    if (data.Status === 400) {
                        alert("Please try again later.");
                    } else { // 200
                        $('#subForm').trigger('reset');
                        $("#success_subscribe").fadeIn();
                        
                    }
            });
        });    

    
        function subscribe_email_popup(){ 
            if (isValidEmailAddress($("#subscribe_email_popup").val())){  
            
                if($('#subscribe_newsletter_popup').is(":checked")) {
                 
                    var action="//mobilefringe.createsend.com/t/d/s/ykblt/"
                    var data = {}
                    data["cm-ykblt-ykblt"] = $("#subscribe_email_popup").val();
                    data["cm-name"] = $("#subscribe_first_name").val() + " " + $("#subscribe_last_name").val();
                    $.getJSON(
                        action + "?callback=?",
                        data,
                        function (data) {
                            if (data.Status === 400) {
                                alert("Please try again.");
                            } else { // 200
                                $("#success_subscribe_popup").fadeIn();
                            }
                    });    
                } else {
                    alert("Please check the 'Subscribe to recieve newsletter' checkbox")
                    
                }
            } else {
                alert("Please enter a valid email address.")
            }
        }
    

    
    
        // function subscribe_email_popup(){ 
        //     if (isValidEmailAddress($("#subscribe_email_popup").val())){   
        //         var action="http://mobilefringe.createsend.com/t/d/s/ykblt/"
        //         var data = {}
        //         data["cm-ykblt-ykblt"] = $("#subscribe_email_popup").val();
        //         data["cm-name"] = $("#subscribe_first_name").val() + " " + $("#subscribe_last_name").val();
        //         $.getJSON(
        //             action + "?callback=?",
        //             data,
        //             function (data) {
        //                 if (data.Status === 400) {
        //                     alert("Veuillez essayer de nouveau s’il vous plaît.");
        //                 } else { // 200
        //                     $("#success_subscribe_popup").fadeIn();
        //                 }
        //         });    
        //     } else {
        //         alert("Veuillez entrez un courriel valide.")
        //     }
        // }
    }

    loadMallData(renderAll);
});
</script>